<?xml version="1.0" encoding="UTF-8"?>
<precice-configuration>
  <!-- Moved data definitions out of solver-interface and applied naming conventions -->
  <data:vector name="Forces"/>
  <data:vector name="Displacements"/>

  <!-- Updated mesh names to use hyphens instead of underscores and added dimensions attribute -->
  <mesh name="NASTIN-Mesh" dimensions="2">
    <use-data name="Displacements"/>
    <use-data name="Forces"/>
  </mesh>

  <mesh name="SOLIDZ-Mesh" dimensions="2">
    <use-data name="Displacements"/>
    <use-data name="Forces"/>
  </mesh>

  <participant name="NASTIN">
    <!-- Replaced use-mesh tags according to new conventions:
         - use-mesh with provide="yes" → provide-mesh
         - use-mesh with from="..." → receive-mesh -->
    <receive-mesh name="SOLIDZ-Mesh" from="SOLIDZ"/>
    <provide-mesh name="NASTIN-Mesh"/>
    
    <write-data name="Forces" mesh="NASTIN-Mesh"/>
    <read-data name="Displacements" mesh="NASTIN-Mesh"/>
    
    <!-- Removed timing attributes from mapping tags and updated mesh names -->
    <mapping:nearest-neighbor 
        direction="write" 
        from="NASTIN-Mesh" 
        to="SOLIDZ-Mesh" 
        constraint="conservative"/>
    <mapping:nearest-neighbor 
        direction="read" 
        from="SOLIDZ-Mesh" 
        to="NASTIN-Mesh" 
        constraint="consistent"/>
  </participant>

  <participant name="SOLIDZ">
    <!-- Replaced use-mesh with provide="yes" -->
    <provide-mesh name="SOLIDZ-Mesh"/>
    <write-data name="Displacements" mesh="SOLIDZ-Mesh"/>
    <read-data name="Forces" mesh="SOLIDZ-Mesh"/>
  </participant>

  <!-- Updated m2n:sockets attributes from 'from'/'to' to 'acceptor'/'connector' -->
  <m2n:sockets acceptor="NASTIN" connector="SOLIDZ" exchange-directory="../"/>

  <coupling-scheme:parallel-implicit>
    <participants first="NASTIN" second="SOLIDZ"/>
    <!-- Renamed max-timesteps to max-time-windows -->
    <max-time-windows value="20"/>
    <!-- Renamed timestep-length to time-window-size -->
    <time-window-size value="1e-3"/>

    <!-- Updated mesh names in exchange definitions -->
    <exchange data="Forces" mesh="SOLIDZ-Mesh" from="NASTIN" to="SOLIDZ"/>
    <exchange data="Displacements" mesh="SOLIDZ-Mesh" from="SOLIDZ" to="NASTIN"/>
    
    <max-iterations value="30"/>
    <relative-convergence-measure limit="1e-4" data="Displacements" mesh="SOLIDZ-Mesh"/>
    <relative-convergence-measure limit="1e-4" data="Forces" mesh="SOLIDZ-Mesh"/>

    <!-- Renamed post-processing:IQN-ILS to acceleration:IQN-ILS and updated parameter names -->
    <acceleration:IQN-ILS>
      <data name="Displacements" mesh="SOLIDZ-Mesh"/>
      <data name="Forces" mesh="SOLIDZ-Mesh"/>
      <preconditioner type="residual-sum"/>
      <filter type="QR1" limit="1e-6"/>
      <initial-relaxation value="0.1"/>
      <max-used-iterations value="30"/>
      <!-- Changed timesteps-reused to time-windows-reused -->
      <time-windows-reused value="2"/>
    </acceleration:IQN-ILS>

  </coupling-scheme:parallel-implicit>
</precice-configuration>
